services:
  backend:
    restart: always
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    command: make live
    hostname: gobackup
    volumes:
      - ./:/app/
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - TZ=Europe/Berlin
      - NTFY_URL=https://ntfy.hoss.it/
      - NTFY_TOPIC=Backup
    ports:
      - 8156:8156
      - 7331:7331

  node:
    restart: always
    build:
      context: .
      dockerfile_inline: |
        FROM node:lts-alpine
        WORKDIR /app
        COPY ./package.json ./yarn.lock ./
        RUN yarn install --frozen-lockfile
    command: sh -c "cp node_modules/alpinejs/dist/cdn.min.js assets/js/alpine.min.js && npx @tailwindcss/cli -i tailwind.css -o assets/css/main.css --watch"
    tty: true
    volumes:
      - ./views:/app/views
      - ./tailwind.css:/app/tailwind.css
      - ./assets:/app/assets
