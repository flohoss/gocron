ARG V_DOCKER
ARG V_GOLANG
ARG V_RCLONE
ARG V_RESTIC
FROM docker:${V_DOCKER}-cli AS docker
FROM rclone/rclone:${V_RCLONE} AS rclone
FROM restic/restic:${V_RESTIC} AS restic
FROM golang:${V_GOLANG}-alpine
RUN apk add tzdata

# Docker
COPY --from=docker --chmod=0755 \
    /usr/local/bin/docker \
    /usr/local/bin/docker

# Docker Compose
COPY --from=docker --chmod=0755 \
    /usr/local/libexec/docker/cli-plugins/docker-compose \
    /usr/local/libexec/docker/cli-plugins/docker-compose

# Rclone
COPY --from=rclone --chmod=0755 \
    /usr/local/bin/rclone /usr/bin/rclone

# Restic
COPY --from=restic --chmod=0755 \
    /usr/bin/restic /usr/bin/restic

# GoBackup
WORKDIR /app
COPY ./go.mod .
COPY ./go.sum .
RUN go mod download

# Air
RUN go install github.com/air-verse/air@latest
COPY ./.air.toml .

# Envs
ENV APP_VERSION=v0.0.1-dev
ENV BUILD_TIME=2023-06-01T08:07:43.454Z
